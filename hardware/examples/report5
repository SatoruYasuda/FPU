report5
iD:05-131024
安田智

◆課題５《ループバック》
実験ボードとRS-232Cで通信せよ

１．ループバック動作を確認せよ(使用するucfファイル)
２．送った文字列を加工して返す回路を作り、動作確認せよ

a)設計方針
今回は配布されているu232c.vhdのソースコードを参考に、ステートマシンとして実装した。
基本的にはrxからの信号をソースファイル"loop.vhd"に書かれた"mirror"が8bitの配列に直し、それを一旦保持し確実に送信するよう管理し、最後にu232cに送信させる。
全体としては

１）"loop.vhd"・・・信号が送られてきて"mirror"が8bitデータを完成させ出力し終わった時に"went"シグナルを1にする。
２）"u232c.vhd"・・・信号を送り終わるとu232cの"busy"が0になる。
３）"top.vhd"・・・"busy"シグナルと"went"シグナルを受け取りバッファの書き換えやu232cへ"go"シグナルを送ることなどを行う中間部分が信号を管理する。

という仕組みになっている。
それぞれ大まかなオートマトンと工夫した点について述べる

２）u232c
これは配布されたものであるので大して手は加えていないが、このステートマシンはストップビットを必ず複数出力するまで次のデータを受け取れないため、入力側が1bitしか出力しない場合間に合わない。よってステートに関する記述を１つ追加し、ストップビットをひとつ送ればすぐに次の出力に移れるようにした。

３）top
大きく分けて６つの状態を持つオートマトンをステートマシンとして実装した。
それぞれwent=1及びbusy=0を受け取ると状態を遷移させ、その際に"go"シグナルを送ったりバッファを書き換えたりすることでmirrorから受け取った情報を管理、確実に送信する。

１）loop.vhd
ステート数１１のステートマシンとして実装した。
当初長さ４のsignal_vectorでステートを管理していたが、なぜか残りの５つのステートに移ってしまいそこからバグが発生し、イカンともしがたい状況だったが、integer range 0 to 10 として管理した所たちどころにうまく行った。
他にもノイズがあるのではないかという疑いから出力の平均を取ったり、スタートビットのよみ損ないに備えてデータが明らかに不正だった場合に全て破棄し最初のステートに戻るなどの工夫をした。
48行目をコメントアウトしてあるが、これを有効にすると小文字を全て大文字に変えるような仕様に変化する。これを設問２への解答とする。


ｂ）実行例，実行結果
キーボード入力・・・問題なく値が帰ってくる
ファイル通信
友人に教えてもらったネット上においてあるかなり大きめなファイル"alice.txt"を試しに送った所、問題なく送れた。
一応こちらもあわせて提出する。
大文字への変換も問題なく行われた。

ｃ）考察
(直接課題とは関係ないが、今回一番痛感したのは人間引き際が肝心という事である。結局これでは他の課題に回す時間が全くなくなってしまった。)




